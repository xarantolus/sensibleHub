var isReload=!1,oldX=0,oldY=0;InstantClick.go=function(url){oldX=window.scrollX,oldY=window.scrollY;var link=document.createElement("a");link.href=url,document.body.appendChild(link),link.click()},InstantClick.on("change",(function(){isReload&&(isReload=!1,window.scrollTo(oldX,oldY))}));var ajax=function(url,data){var wrap=function(method,cb){var xhr=new XMLHttpRequest;xhr.open(method,url,!0),xhr.setRequestHeader("X-XHR","true");var sendstr=null;return"POST"===method&&data&&("entries"in data?sendstr=data:(xhr.setRequestHeader("Content-Type","application/json"),sendstr=JSON.stringify(data))),xhr.onreadystatechange=function(){if(4===xhr.readyState&&xhr.status>0){try{var resp=JSON.parse(xhr.responseText)}catch(e){return void cb(422,{message:xhr.responseText})}cb(xhr.status,resp)}},xhr.onerror=function(){cb(503,{message:"Error while connecting."})},xhr.send(sendstr),xhr};return{get:function(cb){return wrap("GET",cb)},post:function(cb){return wrap("POST",cb)}}};function trimChar(string,charToRemove){for(;string.charAt(0)==charToRemove;)string=string.substring(1);for(;string.charAt(string.length-1)==charToRemove;)string=string.substring(0,string.length-1);return string}function isListingPage(){return location.pathname.startsWith("/album/")||location.pathname.startsWith("/artist/")||-1!==["/","/add","/songs","/artists","/years","/incomplete","/unsynced","/search","/edits"].indexOf(location.pathname)}function registerCover(){function renderImagePreview(evt){var files=evt.target.files;if(1==files.length){document.getElementById("cover-upload-button").innerText=files[0].name;var img=document.getElementById("song-cover");img.src=window.URL.createObjectURL(files[0]),img.style.backgroundColor=null,img.style.border=0,img.style.borderWidth=0;var imgBg=document.querySelector("figure.image");imgBg&&(imgBg.style.background="");var sizeSpan=document.querySelector(".cover-image-size");sizeSpan&&(sizeSpan.style.visibility="hidden")}}function selectCover(evt){"INPUT"!=evt.target.tagName&&"LABEL"!==evt.target.tagName&&"BUTTON"!=evt.target.tagName&&document.querySelector(".file-input").click()}document.getElementById("song-cover-input").addEventListener("change",renderImagePreview),(document.querySelector(".song-image-container")||document.querySelector(".album-image-container")).addEventListener("click",selectCover)}function preloadImage(url){if(Image){var img=new Image;img.src=url,img.onload=function(){}}}InstantClick.on("change",(function(){function loadCovers(){for(var linkedSongs=document.getElementsByClassName("song-link"),i=0;i<Math.min(linkedSongs.length,10);i++)linkedSongs[i].id.startsWith("song-")&&preloadImage("/song/"+linkedSongs[i].id.substr(5)+"/cover")}var sc=document.getElementById("song-cover");sc?sc.addEventListener("load",loadCovers):"/"!=document.location.pathname&&"/search"!=document.location.pathname||loadCovers()})),InstantClick.on("receive",(function(url,body,title){var pref=location.protocol+"//"+location.host;url.startsWith(pref)&&(url=pref.substr(pref.length));var split=url.split("/");"song"==split[0]&&preloadImage("/song/"+split[1]+"/cover")}));