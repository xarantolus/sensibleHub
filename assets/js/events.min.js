function createWebSocket(e){var t="https:"===window.location.protocol?"wss:":"ws:";return new ReconnectingWebSocket(t+"//"+location.host+e,null,{reconnectDecay:1})}function reload(){isReload=!0;try{InstantClick.go(location.toString())}catch(e){isReload=!1}}function setProgressbar(e,t){var s=document.getElementById("main-progress");switch(e){case"progress-start":s.style.display="block";break;case"progress-end":s.style.display="none"}}var firstConnect=!0,ws=createWebSocket("/api/v1/events/ws");ws.onopen=function(){firstConnect||location.reload(),firstConnect=!1};var changedItems={},lastProgress="progress-end";ws.onmessage=function(e){var t=JSON.parse(e.data);console.log(t),t.type.startsWith("song-")&&(isListingPage()?reload():"song-delete"===t.type||isReload||(trimChar(location.pathname,"/")==="song/"+t.data.id?reload():location.pathname.startsWith("/album/")&&reload()),"song-delete"!==t.type&&(changedItems[t.data.id]=Math.random())),t.type.startsWith("progress-")&&(setProgressbar(t.type,t.data),lastProgress=t.type,"/add"===location.pathname&&""===document.getElementById("searchTerm").value.trim()&&reload())},InstantClick.on("receive",function(e,t,s){var o=null,a=t.querySelector("#song-id");return a&&changedItems.hasOwnProperty(a.value)&&(o=t.querySelector("#song-cover"),o&&(o.src=o.src+"#"+changedItems[a.value])),Object.keys(changedItems).forEach(function(e){var s=t.querySelector("#img-"+e);s&&(s.src=s.src+"#"+changedItems[e])}),{body:t,title:s}}),InstantClick.on("change",function(){setProgressbar(lastProgress)});