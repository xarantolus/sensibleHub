function createWebSocket(t){var e="https:"===window.location.protocol?"wss:":"ws:";return new ReconnectingWebSocket(e+"//"+location.host+t,null,{reconnectDecay:1})}function reload(){isReload=!0;try{InstantClick.go(location.toString())}catch(t){isReload=!1}}function setProgressbar(t){var e=document.getElementById("main-progress");switch(t){case"progress-start":e.style.display="block";break;case"progress-end":e.style.display="none"}}var firstConnect=!0,ws=createWebSocket("/api/v1/events/ws");ws.onopen=function(){firstConnect||location.reload(),firstConnect=!1};var lastProgress="progress-end";ws.onmessage=function(t){var e=JSON.parse(t.data);console.log(e),e.type.startsWith("song-")&&(isListingPage()?reload():trimChar(location.pathname,"/")==="song/"+e.data.id&&reload()),e.type.startsWith("progress-")&&(setProgressbar(e.type),lastProgress=e.type)},InstantClick.on("change",function(){setProgressbar(lastProgress)});