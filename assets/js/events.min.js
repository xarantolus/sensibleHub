function createWebSocket(e){var t="https:"===window.location.protocol?"wss:":"ws:";return new ReconnectingWebSocket(t+"//"+location.host+e,null,{reconnectDecay:1})}function reload(){isReload=!0;try{InstantClick.go(location.toString())}catch(e){isReload=!1}}function setProgressbar(e){var t=document.getElementById("main-progress");switch(e){case"progress-start":t.style.display="block";break;case"progress-end":t.style.display="none"}}var firstConnect=!0,ws=createWebSocket("/api/v1/events/ws");ws.onopen=function(){firstConnect||location.reload(),firstConnect=!1};var lastProgress="progress-end";ws.onmessage=function(e){var t=JSON.parse(e.data);console.log(t),t.type.startsWith("song-")&&(isListingPage()?reload():"song-delete"===t.type||isReload||trimChar(location.pathname,"/")==="song/"+t.data.id&&reload()),t.type.startsWith("progress-")&&(setProgressbar(t.type),lastProgress=t.type,"/add"===location.pathname&&""===document.getElementById("url").value.trim()&&reload())},InstantClick.on("change",function(){setProgressbar(lastProgress)});