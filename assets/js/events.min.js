function createWebSocket(path){var protocolPrefix="https:"===window.location.protocol?"wss:":"ws:";return new ReconnectingWebSocket(protocolPrefix+"//"+location.host+path,null,{reconnectDecay:1})}var firstConnect=!0,ws=createWebSocket("/api/v1/events/ws");function reload(){isReload=!0;try{InstantClick.go(location.toString())}catch(e){isReload=!1}}ws.onopen=function(){firstConnect||location.reload(),firstConnect=!1};var changedItems={},lastProgress="progress-end";function setProgressbar(event,data){var progressBar=document.getElementById("main-progress");switch(event){case"progress-start":progressBar.style.display="block";break;case"progress-end":progressBar.style.display="none"}}ws.onmessage=function(evt){var e=JSON.parse(evt.data);if(console.log(e),e.type.startsWith("song-")){if(isListingPage()){var selem=document.getElementById("song-"+e.data.id);selem&&"song-delete"==e.type?selem.remove():reload()}else"song-delete"===e.type||isReload||trimChar(location.pathname,"/")==="song/"+e.data.id&&reload();"song-delete"!==e.type&&(changedItems[e.data.id]=Math.random())}e.type.startsWith("progress-")&&(setProgressbar(e.type,e.data),lastProgress=e.type,"/add"===location.pathname&&""===document.getElementById("searchTerm").value.trim()&&reload())},InstantClick.on("receive",(function(url,body,title){var selem=null,sid=body.querySelector("#song-id");return sid&&changedItems.hasOwnProperty(sid.value)&&(selem=body.querySelector("#song-cover"))&&(selem.src=selem.src+"#"+changedItems[sid.value]),Object.keys(changedItems).forEach((function(id){var i=body.querySelector("#img-"+id);i&&(i.src=i.src+"#"+changedItems[id])})),{body:body,title:title}})),InstantClick.on("change",(function(){setProgressbar(lastProgress)}));