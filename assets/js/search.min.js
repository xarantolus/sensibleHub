var isSearch=!1,nextUrl=null;InstantClick.on("change",(function(){isSearch=!1,isReload=!1,nextUrl?(history.replaceState("","",nextUrl),nextUrl=null):(window.scrollY=0,isSearch&&focusSearch())})),InstantClick.on("change",(function(){if("mediaSession"in navigator){navigator.mediaSession.playbackState="none",navigator.mediaSession.metadata=null;var a=document.querySelector("audio");a&&(a.pause(),a.src="",a.src=null,a.removeAttribute("src"))}})),InstantClick.on("receive",(function(url,body,title){if(isSearch||-1!==url.indexOf("/songs/random")){var song=body.querySelector("#song-id");return song&&(nextUrl="/song/"+song.value),{body:body,title:title}}}));var createSuggestionNode=function(obj){var n=document.createElement("a");n.href="/song/"+obj.id,n.className="navbar-item autosuggest-song",n.dataset.title=obj.title,obj.selected&&(n.className+=" search-selected");var span=document.createElement("span");return span.className="autosuggest-song-name",span.innerText=obj.title,n.append(span),n};function searchSuggestions(loading){var searchText=document.getElementById("search-bar").value.trim(),resultTarget;""!=searchText?(loading(!0),ajax("/api/v1/search?q="+encodeURIComponent(searchText)).get((function(status,obj){if(200===status&&obj.query===searchText){obj.results.length>0&&(1==obj.results.length||obj.results[0].title==selectedText?obj.results[0].selected=!0:(selectedIndex=-1,selectedText=""));var resultTarget=document.getElementById("search-suggestions");resultTarget.innerHTML="";for(var i=0;i<obj.results.length;i++)resultTarget.append(createSuggestionNode(obj.results[i]));loading(!1)}}))):document.getElementById("search-suggestions").innerHTML=""}var selectedIndex=-1,selectedText="";function searchKeypress(evt){if("ArrowUp"===evt.key||38===evt.which){var suggestions=document.getElementById("search-suggestions");return 0==selectedIndex?(suggestions.children[selectedIndex].classList.remove("search-selected"),selectedIndex=-1,selectedText=""):selectedIndex>0&&(suggestions.children[selectedIndex].classList.remove("search-selected"),selectedIndex--,selectedText=suggestions.children[selectedIndex].dataset.title,suggestions.children[selectedIndex].classList.add("search-selected")),evt.preventDefault(),!1}if("ArrowDown"===evt.key||40===evt.which){var suggestions=document.getElementById("search-suggestions");return evt.preventDefault(),-1==selectedIndex?(selectedIndex=0,selectedText=suggestions.children[selectedIndex].dataset.title,suggestions.children[selectedIndex].classList.add("search-selected")):selectedIndex+1<suggestions.children.length&&(suggestions.children[selectedIndex].classList.remove("search-selected"),selectedIndex++,selectedText=suggestions.children[selectedIndex].dataset.title,suggestions.children[selectedIndex].classList.add("search-selected")),evt.preventDefault(),!1}if("Enter"==evt.key||13===evt.which){var suggestions=document.getElementById("search-suggestions");if(selectedIndex>-1&&selectedIndex<suggestions.children.length)return evt.preventDefault(),suggestions.children[selectedIndex].click(),!1}return!0}function initSearch(){var sb=document.getElementById("search-bar"),sc=document.getElementById("search-container"),sf;function setLoading(l){l?sc.classList.add("is-loading"):sc.classList.remove("is-loading")}document.getElementById("search-form").onsubmit=function(evt){evt.preventDefault(),isSearch=!0,isReload=!0,setLoading(!0),InstantClick.go("/search?q="+encodeURIComponent(sb.value))},sb.oninput=function(evt){searchSuggestions(setLoading)},sb.onkeydown=searchKeypress,sb.onfocus=function(evt){searchSuggestions(setLoading)},sb.onblur=function(){setTimeout((function(){var resultTarget;document.getElementById("search-suggestions").innerHTML=""}),500)}}function focusSearch(){var sb=document.getElementById("search-bar");sb&&(document.querySelector(".navbar-burger").classList.toggle("is-active"),document.querySelector(".navbar-menu").classList.toggle("is-active"),sb.value.endsWith(" ")||0===sb.value.length||(sb.value+=" "),sb.setSelectionRange(sb.value.length,sb.value.length),sb.focus())}